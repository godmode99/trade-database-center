เป้าหมายโปรเจค:

1. fetch ข้อมูลต่างๆ จัดรูปแบบหรือคำนวนและบันทึกลง database
2. นำข้อมูลเหล่านั้นมาแสดงที่หน้าเว็บ
3. เป็นจุดรวบรวมข้อมูลให้โปรเจคอื่นๆนำข้อมูลไปใช้ต่อ

เครื่องมือ web site:

1. next.js
2. neon
3. vercel

แหล่ง web ที่ไป fetch raw data (scrape/ api):

1. fred
2. mt5
3. cme fedwatch
4. calendar

raw data ที่ต้องการ

1. fred
   1.1 daily
   - DGS2
   - EFFR
   - ECBDFR
   - ECBESTRVOLWGTTRMDMNRT
   - DTWEXBGS
   - VIXCLS

     1.2 weekly

   - DGS2
   - EFFR
   - ECBDFR
   - ECBESTRVOLWGTTRMDMNRT
   - DTWEXBGS
   - VIXCLS
   - DGS10
   - DFII10
   - BAMLH0A0HYM2
   - T10YIE

     1.3 montly

   - DGS2
   - EFFR
   - ECBDFR
   - ECBESTRVOLWGTTRMDMNRT
   - DTWEXBGS
   - VIXCLS
   - DGS10
   - DFII10
   - BAMLH0A0HYM2
   - T10YIE
   - CPILFESL
   - PAYEMS

2. cme fedwatch
   2.1 probabilities
   - sofr
   - zq

     2.2 quote

   - daily: zq, sr1, sr3, zt, 6e
   - weekly: zq, sr1, sr3, zn, 6e, zt, zf, zb
   - monthly: zq, sr1, sr3, zn, tn, zb, ub, twe, 6e, e7, m6e

3. calendar
   3.1 fetch weekly ดึงข้อมูลทั้งหมดของสัปดาห์ปัจจุบัน ข่าวไหนที่ยังไม่ออกก็ให้ actual ว่างไว้
   3.2 fetch update เมื่อข่าวออกอัพเดท actual

4. mt5
   4.1 raw ohlcv m15, h4, d1, w1, m1
   4.2 feature คำนวน ohlcv - tr - atr14 - range - body - upper_wick - lower_wick - close_pos - swing_high - swing_low - structure_event - bos_up - bos_dn - choch_up - choch_dn - ema20 - ema50 - pdh - pdl - pdc - sweep_prev_high - sweep_prev_low

---

## สถานะเอกสาร (อัปเดตล่าสุด)
- อัปเดตรอบ 2026-02-28 11:51 UTC: เพิ่มเอกสารคู่มือการใช้งานฐานข้อมูล Neon ที่ `god_project/neon/คู่มือการใช้งาน-database.md` ครอบคลุมการตั้งค่า env, การรัน migration, ตัวอย่าง upsert/query และแนวทาง monitor `ops.pipeline_runs` เพื่อให้ทีม fetch/API/web ใช้งานฐานข้อมูลชุดเดียวกันได้ตรงกัน
- อัปเดตรอบ 2026-02-28 11:46 UTC: ส่งมอบไฟล์ migration schema v1 จริงใน path มาตรฐาน `god_project/neon/migrations/202602280001_schema_v1.sql` (แก้ความคลาดเคลื่อนจากบันทึกเดิมที่อ้าง `god project/...`) และกำหนดโครงสร้างครบ `ops/raw/features/normalized` พร้อมตารางหลัก, constraints, indexes และ normalized latest views สำหรับ API/Web
- อัปเดตรอบ 2026-02-28 11:40 UTC: ปรับเอกสารส่วนที่เกี่ยวข้องทั้งหมดให้เปลี่ยนฐานข้อมูลเป้าหมายจากชื่อเดิมมาใช้ Neon อย่างสอดคล้องทั้ง tooling, schema, pipeline และแผนงาน
- ปรับ `แผนการพัฒนาโครงการ.md` เป็นแผนละเอียดระดับระบบ โดยเพิ่ม Input/Output/Spec รายแหล่งข้อมูล (Calendar, FRED, MT5, CME)
- เพิ่มสเปก Neon schema v1, index/constraint ที่จำเป็น, API contract ขั้นต่ำ และ test plan
- คงลำดับพัฒนาเดิม: เริ่ม Foundation ที่ Calendar pipeline + schema กลาง ก่อนขยายสู่แหล่งข้อมูลอื่น

- อัปเดตรอบ 2026-02-28 09:06 UTC: ออกแบบ Neon schema v1 และเพิ่ม migration script ที่ `god project/neon/migrations/202602280001_schema_v1.sql` ครอบคลุม schema `ops/raw/features/normalized`, ตารางหลักทั้ง 7 ตาราง และ view `normalized.*_latest` สำหรับหน้าเว็บ

- อัปเดตรอบ 2026-02-28 09:10 UTC: ทบทวน migration v1 และปรับ schema ให้รองรับ upsert จริงมากขึ้น (แก้ unique key กรณี NULL ด้วย expression index, เพิ่ม check constraint ที่จำเป็น, เพิ่ม trigger อัปเดต `updated_at_utc` อัตโนมัติ)

- อัปเดตรอบ 2026-02-28 09:46 UTC: พัฒนาหน้าเว็บส่วน Calendar ใน `god project/web_trade-data-hub/app/page.tsx` จาก starter template เป็นหน้า Dashboard เบื้องต้น (สรุปตัวเลข + ตาราง upcoming economic calendar) เพื่อรองรับการเชื่อมข้อมูลจริงจากฐานข้อมูลในลำดับถัดไป

- อัปเดตรอบ 2026-02-28 09:52 UTC: พัฒนา pipeline `god project/fetch/calendar/main.py` ให้ fetch ข้อมูลปฏิทินเศรษฐกิจ, normalize ฟิลด์, และ upsert เข้า Neon ตาราง `raw.calendar_events` พร้อมบันทึกสถานะ run ลง `ops.pipeline_runs` (รองรับ success/failed และ batch upsert)
- เพิ่มไฟล์ตั้งค่า `god project/fetch/calendar/config.yaml` สำหรับกำหนด source endpoint, batch size และการอ่าน credentials จาก env (`NEON_URL`, `NEON_SERVICE_ROLE_KEY`)

- อัปเดตรอบ 2026-02-28 10:02 UTC: แก้ปัญหา runtime ของ Calendar pipeline กรณีสั่งรันจาก root repo แล้วหา `config.yaml` ไม่เจอ โดยปรับ `god_project/fetch/calendar/main.py` ให้ resolve path ของ config แบบอัตโนมัติเทียบกับตำแหน่งไฟล์สคริปต์

- อัปเดตรอบ 2026-02-28 10:29 UTC: ปรับ `god_project/fetch/calendar/main.py` ให้โหลดค่า env อัตโนมัติจากไฟล์ `.env`/`.env.local` (ทั้ง root และโฟลเดอร์สคริปต์/config) และเพิ่ม fallback key ของ Neon (`NEXT_PUBLIC_NEON_URL`, `NEON_SECRET_KEY`, `NEON_ANON_KEY`) เพื่อลดปัญหา `Missing Neon URL/API key in env or config` เวลาเรียกจากเครื่อง local

- อัปเดตรอบ 2026-02-28 10:38 UTC: ปรับ `god_project/fetch/calendar/main.py` เพิ่มโหมดควบคุมการเขียน DB
  - ค่าเริ่มต้น: ถ้าไม่พบ Neon URL/API key จะไม่ fail ทันที แต่แสดง `WARN` และจบแบบ fetch/normalize สำเร็จ
  - เพิ่มออปชัน `--require-db` สำหรับบังคับ fail เมื่อ credentials หาย (เหมาะกับ production/scheduler)

- อัปเดตรอบ 2026-02-28 10:55 UTC: บันทึกข้อเท็จจริงการรัน `python god_project/fetch/calendar/main.py` ฝั่ง local ว่า `Fetched items=85 normalized=85` หมายถึงขั้น fetch+normalize สำเร็จ และข้อความ `WARN: Missing Neon URL/API key in env or config, skip database write` เป็นพฤติกรรมที่ตั้งใจไว้ของ default mode เมื่อไม่พบ credentials (งานจะไม่เขียน DB แต่ไม่ถือว่า pipeline แตก)

- อัปเดตรอบ 2026-02-28 11:10 UTC: ปรับ `god_project/fetch/calendar/main.py` ให้ loader รองรับไฟล์ `god_project/fetch/neon.env` โดยตรง (ทั้งจาก CWD และจาก path เทียบกับโฟลเดอร์ fetch) เพื่อให้คำสั่ง `python god_project/fetch/calendar/main.py` อ่านค่า Neon จากไฟล์นี้ได้ทันที

- อัปเดตรอบ 2026-02-28 11:58 UTC: ปรับคู่มือ `god_project/neon/คู่มือการใช้งาน-database.md` ในหัวข้อเตรียม environment ให้เป็นขั้นตอนทีละข้อ (แยกกรณี migration SQL กับ pipeline REST) พร้อมตัวอย่าง `export`, การใช้ไฟล์ `god_project/fetch/supabase.env`, และคำสั่งตรวจสอบ env เพื่อช่วยลดความสับสนเวลาเริ่มใช้งาน
